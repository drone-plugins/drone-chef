#!/usr/bin/env ruby

$LOAD_PATH.unshift('/opt/drone-chef/lib') if Dir.exist? '/opt/drone-chef/lib'

require 'drone_chef'
require 'json'

build_data = JSON.parse ARGV[1]
type = build_data['vargs']['type'] || 'supermarket'

case type
when 'supermarket'
  server = DroneChef::Supermarket.new ARGV[1]
when 'server'
  server = DroneChef::ChefServer.new ARGV[1]
else
  fail "Invalid type '#{type}' specified"
end

server.write_configs
server.upload
