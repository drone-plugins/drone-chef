pipeline:
  test:
    image: ruby:2.3-alpine
    commands:
      - apk update
      - apk add build-base

      - bundle install --path=gems --retry=5 --jobs=5
      - bin/rake
  docker:
    storage_driver: overlay
    repo: plugins/drone-chef
    tags: [ "latest" ]
    when:
      branch: release/0.4
      event: push

plugin:
  name: Chef
  desc: Publish files and artifacts to Chef Server
  type: publish
  image: plugins/drone-chef
  labels:
    - chef
    - ruby
